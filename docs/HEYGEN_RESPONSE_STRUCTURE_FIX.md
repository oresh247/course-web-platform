# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–≤–µ—Ç–∞ HeyGen API

## –ü—Ä–æ–±–ª–µ–º–∞

–°–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞ –æ—à–∏–±–∫—É `"HeyGen generation failed: –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (code: unknown)"` –¥–∞–∂–µ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–∏–¥–µ–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞ HeyGen API.

### –ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã:
HeyGen API –∏–∑–º–µ–Ω–∏–ª —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞ —Å:
```json
{
  "video_id": "c97f571975a5401e8b31cb465a6e2dbe"
}
```

–ù–∞:
```json
{
  "error": null,
  "data": {
    "video_id": "c97f571975a5401e8b31cb465a6e2dbe"
  }
}
```

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏:
```
INFO - HTTP —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ HeyGen: 200
INFO - –ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç HeyGen API: {'error': None, 'data': {'video_id': 'c97f571975a5401e8b31cb465a6e2dbe'}}
ERROR - HeyGen –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–∏–¥–µ–æ: –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–∫–æ–¥: unknown)
ERROR - –ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç —Å –æ—à–∏–±–∫–æ–π: {'error': None, 'data': {'video_id': 'c97f571975a5401e8b31cb465a6e2dbe'}}
```

### –ü—Ä–æ–±–ª–µ–º–∞:
–°–∏—Å—Ç–µ–º–∞ –∏—Å–∫–∞–ª–∞ `video_id` –≤ –∫–æ—Ä–Ω–µ –æ—Ç–≤–µ—Ç–∞ (`result.get('video_id')`), –Ω–æ –æ–Ω –Ω–∞—Ö–æ–¥–∏–ª—Å—è –≤ `result['data']['video_id']`.

## –†–µ—à–µ–Ω–∏–µ ‚úÖ

### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–≤–µ—Ç–∞ HeyGen**

**heygen_service.py:**
```python
response.raise_for_status()
result = response.json()

# –õ–æ–≥–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç HeyGen –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
logger.info(f"–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç HeyGen API: {result}")

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞ HeyGen
video_id = None
if result.get('data') and result['data'].get('video_id'):
    # –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: {"data": {"video_id": "..."}}
    video_id = result['data']['video_id']
elif result.get('video_id'):
    # –°—Ç–∞—Ä–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: {"video_id": "..."}
    video_id = result['video_id']

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –≤ –æ—Ç–≤–µ—Ç–µ HeyGen
if video_id is None:
    error_message = result.get('message', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏')
    error_code = result.get('code', 'unknown')
    logger.error(f"HeyGen –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–∏–¥–µ–æ: {error_message} (–∫–æ–¥: {error_code})")
    logger.error(f"–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç —Å –æ—à–∏–±–∫–æ–π: {result}")
    raise Exception(f"HeyGen generation failed: {error_message} (code: {error_code})")

logger.info(f"–í–∏–¥–µ–æ —Å–æ–∑–¥–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ: {video_id}")

# –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
return {
    'video_id': video_id,
    'script': result.get('data', {}).get('script', ''),
    'created_at': result.get('data', {}).get('created_at', ''),
    'status': result.get('data', {}).get('status', 'generating')
}
```

### 2. **–û–±–Ω–æ–≤–ª–µ–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç**

**test_error_handling.py:**
```python
elif response.status_code == 200:
    try:
        data = response.json()
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞ HeyGen
        video_id = None
        if data.get('data') and data['data'].get('video_id'):
            # –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: {"data": {"video_id": "..."}}
            video_id = data['data']['video_id']
        elif data.get('video_id'):
            # –°—Ç–∞—Ä–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: {"video_id": "..."}
            video_id = data['video_id']
        
        if video_id:
            print(f"\n–í–∏–¥–µ–æ —Å–æ–∑–¥–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ: {video_id}")
            print(f"   –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞: {data}")
        else:
            print(f"\n–û—à–∏–±–∫–∞: video_id –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç")
            print(f"   –î–∞–Ω–Ω—ã–µ: {data}")
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: {e}")
```

## –°—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤ HeyGen API

### 1. **–ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (—Ç–µ–∫—É—â–∞—è)**
```json
{
  "error": null,
  "data": {
    "video_id": "c97f571975a5401e8b31cb465a6e2dbe",
    "script": "–¢–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á–∏–≤–∞–Ω–∏—è",
    "created_at": "2025-10-28T20:27:40Z",
    "status": "generating"
  }
}
```

### 2. **–°—Ç–∞—Ä–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)**
```json
{
  "video_id": "c97f571975a5401e8b31cb465a6e2dbe",
  "script": "–¢–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á–∏–≤–∞–Ω–∏—è",
  "created_at": "2025-10-28T20:27:40Z",
  "status": "generating"
}
```

### 3. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—à–∏–±–∫–∏**
```json
{
  "error": {
    "code": "trial_video_limit_exceeded",
    "message": "It seems you've reached your daily api trial limit 5."
  },
  "data": null
}
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤**
**–í–º–µ—Å—Ç–æ:**
```
ERROR - HeyGen –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–∏–¥–µ–æ: –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–∫–æ–¥: unknown)
```

**–¢–µ–ø–µ—Ä—å:**
```
INFO - –í–∏–¥–µ–æ —Å–æ–∑–¥–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ: c97f571975a5401e8b31cb465a6e2dbe
```

### ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–µ–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä**
- –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: `result['data']['video_id']`
- –°—Ç–∞—Ä–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: `result['video_id']`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### ‚úÖ **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç**
```python
return {
    'video_id': video_id,
    'script': result.get('data', {}).get('script', ''),
    'created_at': result.get('data', {}).get('created_at', ''),
    'status': result.get('data', {}).get('status', 'generating')
}
```

### ‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –æ–±–µ–∏–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ –æ—Ç–≤–µ—Ç–æ–≤ HeyGen API.

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### 1. **–¢–µ—Å—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–≤–µ—Ç–∞**
```bash
cd backend
python test_error_handling.py
```

### 2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ**
- –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:3000/video-test`
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–µ–æ
- –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ: "–í–∏–¥–µ–æ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ –æ—á–µ—Ä–µ–¥—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏"
- –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: "–í–∏–¥–µ–æ —Å–æ–∑–¥–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ: [video_id]"

### 3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤**
–í –ª–æ–≥–∞—Ö –±—ç–∫–µ–Ω–¥–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
INFO - HTTP —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ HeyGen: 200
INFO - –ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç HeyGen API: {'error': None, 'data': {'video_id': 'c97f571975a5401e8b31cb465a6e2dbe'}}
INFO - –í–∏–¥–µ–æ —Å–æ–∑–¥–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ: c97f571975a5401e8b31cb465a6e2dbe
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–±–ª–µ–º–∞ —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –æ—Ç–≤–µ—Ç–∞ HeyGen API –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞! –¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞:

- üéØ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç** –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞ HeyGen
- üéØ **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å–æ —Å—Ç–∞—Ä–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- üéØ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç** —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞
- üéØ **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π** —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- üéØ **–ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ª–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏** –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–∏–¥–µ–æ

–°–∏—Å—Ç–µ–º–∞ AI Course Builder —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π HeyGen API! üöÄ
